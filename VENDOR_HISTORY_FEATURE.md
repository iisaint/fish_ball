# 廠商歷史訂單功能

## 📅 更新日期
2026-01-09

## 🎯 功能簡介

在廠商管理後台新增「歷史記錄」功能，讓廠商可以查看所有已完成的訂單，方便追蹤和回顧過往業務。

## ✨ 主要功能

### 1. 標籤切換介面

廠商後台現在提供兩個標籤：

| 標籤 | 說明 | 顯示內容 |
|------|------|---------|
| **⏰ 待處理訂單** | 進行中的訂單 | `orderStatus` 為 'submitted' 或 'confirmed'<br/>且 `status` 不是 'completed' |
| **✅ 歷史記錄** | 已完成的訂單 | `status` 為 'completed' |

### 2. 視覺區分

#### 待處理訂單卡片
- 白色背景
- 紫色邊框（hover 時）
- 紫色金額顯示
- 狀態標籤：
  - 🕐 待確認（黃色）
  - ✅ 已確認（綠色）

#### 歷史訂單卡片
- 綠色淡背景 (`bg-green-50`)
- 綠色邊框 (`border-green-200`)
- 綠色金額顯示
- ✅ 已完成標籤（綠色）
- 顯示完成日期

### 3. 歷史訂單詳情（唯讀模式）

點擊歷史訂單卡片可查看詳細資訊，但所有操作功能會被禁用：

| 功能 | 狀態 | 說明 |
|------|------|------|
| 🎉 已完成標籤 | ✅ 顯示 | 綠色橫幅，顯示完成時間 |
| 📦 出貨狀態 | ❌ 隱藏 | 已完成訂單不需調整 |
| 💰 價格調整 | ❌ 禁用 | 「調整價格」按鈕隱藏 |
| 📝 備註編輯 | ❌ 唯讀 | 文字框禁用，顯示「唯讀」標籤 |
| ✅ 確認收單 | ❌ 隱藏 | 已完成訂單不需確認 |
| 🏁 標記完成 | ❌ 隱藏 | 已經完成的訂單 |
| 🖨️ 列印功能 | ✅ 可用 | 可以列印歷史訂單 |

## 🎨 UI 設計

### 標籤切換
```
┌─────────────────────────────────────┐
│ [⏰ 待處理訂單 3] [✅ 歷史記錄 12] │ ← 標籤
├─────────────────────────────────────┤
│                                     │
│  [訂單卡片 1]  [訂單卡片 2]  ...   │
│                                     │
└─────────────────────────────────────┘
```

### 歷史訂單卡片
```
┌─────────────────────────────────┐
│ 王小明          [✅ 已完成]     │
│ 代碼：abc123                   │
│                                 │
│ 📅 結單日期：2026-01-05        │
│ ✅ 完成日期：2026-01-07        │
│ 📍 地點：台北市信義區          │
│ 📞 電話：0912-345-678          │
│                                 │
│ 15 筆訂單          $12,500     │
└─────────────────────────────────┘
  ↑ 綠色背景和邊框
```

### 已完成訂單詳情頁
```
┌─────────────────────────────────────┐
│ ← 返回團購列表                      │
├─────────────────────────────────────┤
│ ✅ 此訂單已完成               🎉  │
│ 完成時間：2026-01-07 14:30        │
├─────────────────────────────────────┤
│ 團購資訊                   [🖨️列印]│
│ ...                                 │
├─────────────────────────────────────┤
│ 產品統計與價格          [唯讀]     │
│ (無「調整價格」按鈕)                │
├─────────────────────────────────────┤
│ 訂單明細                            │
│ ...                                 │
├─────────────────────────────────────┤
│ 廠商備註                [唯讀]     │
│ [已禁用的文字框]                    │
└─────────────────────────────────────┘
```

## 📊 資料結構

已完成的訂單會有 `completedAt` 時間戳：

```javascript
{
  "groups": {
    "groupId123": {
      "info": {
        "name": "王小明",
        "status": "completed",  // 標記為已完成
        "orderStatus": "confirmed",
        "createdAt": 1704729600000,
        "completedAt": 1704902400000  // 完成時間
      },
      "orders": { ... },
      "vendorNotes": { ... }
    }
  }
}
```

## 🔍 實作細節

### 1. 狀態管理

新增兩個狀態：

```javascript
const [completedGroups, setCompletedGroups] = useState([]);
const [activeTab, setActiveTab] = useState('active'); // 'active' or 'history'
```

### 2. 資料篩選

在 `useEffect` 中同時載入兩種列表：

```javascript
// 進行中的訂單
const activeGroups = groupsList.filter(g => {
    return g.info?.status !== 'completed' && 
           (g.info?.orderStatus === 'submitted' || 
            g.info?.orderStatus === 'confirmed');
});

// 已完成的訂單
const finishedGroups = groupsList.filter(g => {
    return g.info?.status === 'completed';
});
```

### 3. 條件渲染

在詳情頁面加入條件判斷：

```javascript
{groupData.info?.status !== 'completed' && (
    // 只在未完成時顯示的功能
)}

{groupData.info?.status === 'completed' && (
    // 只在已完成時顯示的標籤
)}
```

## 🧪 測試步驟

### 準備工作

1. 開啟開發伺服器
   ```bash
   pnpm dev
   ```

2. 建立一個測試訂單並完成

### 測試情境 1：查看歷史列表

1. 以廠商身份登入
2. 點擊「歷史記錄」標籤
3. ✅ **確認：顯示已完成的訂單**
4. ✅ **確認：卡片為綠色背景**
5. ✅ **確認：顯示「已完成」標籤**
6. ✅ **確認：顯示完成日期**

### 測試情境 2：查看歷史訂單詳情

1. 點擊任一歷史訂單卡片
2. ✅ **確認：頂部顯示「此訂單已完成」橫幅**
3. ✅ **確認：沒有「出貨狀態」區塊**
4. ✅ **確認：產品統計表格無「調整價格」按鈕**
5. ✅ **確認：備註欄位為禁用狀態**
6. ✅ **確認：沒有「確認收單」或「標記完成」按鈕**
7. ✅ **確認：可以正常列印**

### 測試情境 3：標籤切換

1. 點擊「待處理訂單」標籤
2. ✅ **確認：只顯示進行中的訂單**
3. 點擊「歷史記錄」標籤
4. ✅ **確認：只顯示已完成的訂單**
5. ✅ **確認：標籤數字正確**

### 測試情境 4：排序

1. 在「歷史記錄」中
2. ✅ **確認：訂單按完成時間排序（最新在前）**

## 💡 使用場景

### 場景 1：月度對帳
廠商可以切換到「歷史記錄」，查看本月完成的所有訂單，統計營業額。

### 場景 2：客戶查詢
當團主詢問之前的訂單時，廠商可以快速在歷史記錄中查找。

### 場景 3：業務分析
廠商可以回顧過往訂單，了解哪些產品最受歡迎，哪些團主訂單量最大。

### 場景 4：重複訂單
如果團主想要重複之前的訂單，廠商可以查看歷史記錄作為參考。

## 🚀 未來改進方向

1. **進階篩選**
   - 依日期範圍篩選
   - 依團主姓名搜尋
   - 依金額排序

2. **統計圖表**
   - 每月訂單數量
   - 營業額趨勢
   - 熱門產品排行

3. **匯出功能**
   - 匯出 Excel 報表
   - 匯出 PDF 總結

4. **訂單比較**
   - 對比不同時期的訂單
   - 分析成長趨勢

5. **快速復製**
   - 一鍵複製歷史訂單
   - 快速建立相似團購

## 📁 修改檔案

| 檔案 | 修改內容 |
|------|---------|
| `src/pages/VendorView.jsx` | 新增歷史訂單功能、標籤切換、唯讀模式 |
| `README.md` | 更新廠商功能說明 |
| `VENDOR_HISTORY_FEATURE.md` | 新功能說明文件（本檔） |

## ✅ 完成清單

- [x] 新增 `completedGroups` 狀態
- [x] 新增 `activeTab` 狀態
- [x] 實作標籤切換 UI
- [x] 篩選已完成訂單
- [x] 設計歷史訂單卡片樣式
- [x] 實作唯讀模式
- [x] 隱藏/禁用操作功能
- [x] 顯示完成時間
- [x] 更新 README.md
- [x] 無語法錯誤

## 🎉 結論

歷史訂單功能讓廠商後台更完整，不僅可以處理當前訂單，還能回顧過往記錄，大幅提升業務管理效率！

---

**功能實作完成** ✨

